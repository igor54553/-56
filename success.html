<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–û–ø–ª–∞—Ç–∞ —É—Å–ø—ñ—à–Ω–∞</title>
  <meta name="color-scheme" content="light">
  <link rel="stylesheet" href="style.css" />
  <style>
    body{display:flex;min-height:100vh;align-items:center;justify-content:center;background:#f3f5f7;color:#222}
    .wrap{max-width:720px;background:#fff;border-radius:16px;padding:28px;box-shadow:0 12px 40px rgba(0,0,0,.12);text-align:center}
    .btn{display:inline-block;margin-top:14px;padding:12px 18px;border-radius:10px;background:#607d8b;color:#fff;text-decoration:none;font-weight:700}
    .muted{opacity:.8;font-size:.95rem;margin-top:8px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>–î—è–∫—É—î–º–æ –∑–∞ –æ–ø–ª–∞—Ç—É!</h1>
    <p>–í–∞—à –¥–æ—Å—Ç—É–ø:</p>
    <p><a id="productLink" class="btn" href="./guide/" target="_blank" rel="noopener">–í—ñ–¥–∫—Ä–∏—Ç–∏ –≥–∞–π–¥</a></p>
    <p class="muted" id="mailState">–ù–∞–¥—Å–∏–ª–∞—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≤–∞—à—É –ø–æ—à—Ç—É‚Ä¶</p>
  </div>

<script>
// === –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ===
// –¢–≤—ñ–π GAS –¥–ª—è –ª–∏—Å—Ç—ñ–≤ (Web App) —ñ —Å–µ–∫—Ä–µ—Ç ‚Äî –∑–±–µ—Ä–µ–∂–µ–Ω—ñ –∑ –º–∏–Ω—É–ª–∏—Ö –∫—Ä–æ–∫—ñ–≤
const GAS_ENDPOINT  = 'https://script.google.com/macros/s/AKfycbzO1vWY2GGNoSfogdt0vIuNIMCZlaKvRdv7DJytpzFjWsW3GFIGOvbfhWDEtK_gsI5L/exec';
const SHARED_SECRET = 'Gor22067132';
// –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≥–∞–π–¥ ‚Äî –≤—ñ–¥–Ω–æ—Å–Ω–æ —Ü—ñ—î—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (–º–æ–∂–Ω–∞ –∑–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ –±—É–¥—å-—è–∫–∏–π –∞–±—Å–æ–ª—é—Ç–Ω–∏–π URL)
const GUIDE_URL = 'https://igor54553.github.io/6-/';


(function () {
  const stateEl = document.getElementById('mailState');
  const linkEl = document.getElementById('productLink');
  if (linkEl) linkEl.href = GUIDE_URL;

  // 1) —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∑—è—Ç–∏ email –∑ URL (?email=...) ‚Äî —è–∫—â–æ –ø—Ä–æ–∫—Å—ñ –π–æ–≥–æ –ø–µ—Ä–µ–¥–∞–≤
  const urlEmail = (new URL(location.href)).searchParams.get('email') || '';
  if (urlEmail && !localStorage.getItem('buyer_email')) {
    localStorage.setItem('buyer_email', urlEmail.trim());
  }

  // 2) –æ—Å–Ω–æ–≤–Ω–µ –¥–∂–µ—Ä–µ–ª–æ ‚Äî localStorage (–º–æ–¥–∞–ª–∫–∞ –Ω–∞ index.html —Ç—É–¥–∏ –ø–∏—à–µ)
  let email = (localStorage.getItem('buyer_email') || '').trim();

  if (!email) {
    // 3) –∫–æ–º–ø–∞–∫—Ç–Ω–∞ —Ñ–æ—Ä–º–∞-—Ñ–æ–ª–±–µ–∫ –ø—Ä—è–º–æ —Ç—É—Ç
    stateEl.innerHTML = 'E-mail –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ. –í–∫–∞–∂—ñ—Ç—å –∞–¥—Ä–µ—Å—É ‚Äî –º–∏ –Ω–∞–¥—ñ—à–ª–µ–º–æ –¥–æ—Å—Ç—É–ø: ' +
      '<input id="fallbackEmail" type="email" placeholder="you@example.com" style="margin-left:6px;padding:6px 8px;border:1px solid #ccc;border-radius:6px">' +
      '<button id="sendFallback" class="btn" style="margin-left:8px">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>';
    document.getElementById('sendFallback')?.addEventListener('click', () => {
      const v = (document.getElementById('fallbackEmail').value || '').trim();
      if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v)) { alert('–í–≤–µ–¥—ñ—Ç—å –∫–æ—Ä–µ–∫—Ç–Ω–∏–π e-mail'); return; }
      localStorage.setItem('buyer_email', v);
      email = v;
      sendMail(email);
    });
    return;
  }

  // 4) e-mail —î ‚Äî –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ –ª–∏—Å—Ç
  sendMail(email);

  function sendMail(to){
    if (sessionStorage.getItem('mail_sent') === '1') {
      stateEl.textContent = '–õ–∏—Å—Ç —É–∂–µ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ—à—Ç—É üôÇ';
      return;
    }
    stateEl.textContent = '–ù–∞–¥—Å–∏–ª–∞—î–º–æ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≤–∞—à—É –ø–æ—à—Ç—É‚Ä¶';

    fetch(GAS_ENDPOINT, {
      method: 'POST',
      mode: 'no-cors',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        secret: SHARED_SECRET,
        email: to,
        title: '–î–æ—Å—Ç—É–ø –¥–æ –≥–∞–π–¥—É',
        link_url: GUIDE_URL,
        name: 'MI.CARDIOLOGIST'
      })
    }).catch(()=>{}).finally(()=>{
      sessionStorage.setItem('mail_sent', '1');
      stateEl.textContent = '–õ–∏—Å—Ç –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ—à—Ç—É üôÇ';
    });
  }
})();
</script>
</body>
</html>

